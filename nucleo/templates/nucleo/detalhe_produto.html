{% extends 'nucleo/base.html' %}


{% block title %}{{ produto.nome }} - NerdHub{% endblock %}
{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static 'css/detalhe_produto.css' %}">

<div class="produto-detalhe-container">
    <div class="produto-main">
        <div class="produto-galeria">
            <img id="imagem-principal" src="{{ produto.imagem_principal.url }}" alt="{{ produto.nome }}">
            <div class="miniaturas">
                <img src="{{ produto.imagem_principal.url }}" onclick="trocarImagem(this)">
                {% for imagem in produto.imagens_adicionais.all %}
                    <img src="{{ imagem.imagem.url }}" onclick="trocarImagem(this)">
                {% endfor %}
            </div>
        </div>

        <div class="produto-info">
            <h2>{{ produto.nome }}</h2>
            <p class="descricao">{{ produto.descricao }}</p>
            {% if produto.preco %}
                <p class="preco">R$ {{ produto.preco }}</p>
            {% endif %}
            <form action="{% url 'nucleo:adicionar_ao_carrinho' produto.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn-comprar" {% if produto.estoque < 1 %}disabled{% endif %}>
                    {% if produto.estoque < 1 %}Sem estoque{% else %}Adicionar ao carrinho{% endif %}
                </button>
            </form>
        </div>
    </div>

    <div class="produto-reviews">
        <h3>Avaliações</h3>
        {% for review in reviews %}
            <div class="review">
                <strong>{{ review.usuario.username }}</strong> - ⭐{{ review.nota }} <p>{{ review.texto }}</p>
            </div>
        {% empty %}
            <p>Seja o primeiro a avaliar!</p>
        {% endfor %}

        {% if user.is_authenticated %}
        <form action="{% url 'nucleo:adicionar_review' produto.id %}" method="post">
            {% csrf_token %}
            <textarea name="texto" required></textarea>
            <select name="nota">
                {% for i in "12345" %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
            <button type="submit">Enviar</button>
        </form>
        {% endif %}
    </div>

    <div class="produtos-relacionados">
        <h3>Produtos relacionados</h3>
        <div class="lista-relacionados">
            {% for p in relacionados %}
                <div class="item-relacionado">
                    <a href="{% url 'nucleo:detalhe_produto' p.id %}">
                        <img src="{{ p.imagem_principal.url }}" alt="{{ p.nome }}">
                        <p>{{ p.nome }}</p>
                    </a>
                </div>
            {% empty %}
                <p>Sem produtos relacionados</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function trocarImagem(elem) {
    document.getElementById('imagem-principal').src = elem.src;
}
</script>
{% endblock %}
